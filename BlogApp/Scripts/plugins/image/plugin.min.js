tinymce.PluginManager.add("image",function(n){function u(n,t){function u(n,r){i.parentNode&&i.parentNode.removeChild(i);t({width:n,height:r})}var i=document.createElement("img"),r;i.onload=function(){u(i.clientWidth,i.clientHeight)};i.onerror=function(){u()};r=i.style;r.visibility="hidden";r.position="fixed";r.bottom=r.left=0;r.width=r.height="auto";document.body.appendChild(i);i.src=n}function r(n,t,i){function r(n,i){return i=i||[],tinymce.each(n,function(n){var u={text:n.text||n.title};n.menu?u.menu=r(n.menu):(u.value=n.value,t(u));i.push(u)}),i}return r(n,i||[])}function t(t){return function(){var i=n.settings.image_list;typeof i=="string"?tinymce.util.XHR.send({url:i,success:function(n){t(tinymce.util.JSON.parse(n))}}):typeof i=="function"?i(t):t(i)}}function i(t){function v(){var i,r,n,t;(i=o.find("#width")[0],r=o.find("#height")[0],i&&r)&&(n=i.value(),t=r.value(),o.find("#constrain")[0].checked()&&s&&h&&n&&t&&(s!=n?(t=Math.round(n/s*t),r.value(t)):(n=Math.round(t/h*n),i.value(n))),s=n,h=t)}function w(){function t(t){function r(){t.onload=t.onerror=null;n.selection&&(n.selection.select(t),n.nodeChanged())}t.onload=function(){i.width||i.height||!a||e.setAttribs(t,{width:t.clientWidth,height:t.clientHeight});r()};t.onerror=r}b();v();i=tinymce.extend(i,o.toJSON());i.alt||(i.alt="");i.width===""&&(i.width=null);i.height===""&&(i.height=null);i.style||(i.style=null);i={src:i.src,alt:i.alt,width:i.width,height:i.height,style:i.style,"class":i["class"]};n.undoManager.transact(function(){if(!i.src){f&&(e.remove(f),n.focus(),n.nodeChanged());return}f?e.setAttribs(f,i):(i.id="__mcenew",n.focus(),n.selection.setContent(e.createHTML("img",i)),f=e.get("__mcenew"),e.setAttrib(f,"id",null));t(f)})}function y(n){return n&&(n=n.replace(/px$/,"")),n}function k(t){var i=t.meta||{};l&&l.value(n.convertURL(this.value(),"src"));tinymce.each(i,function(n,t){o.find("#"+t).value(n)});i.width||i.height||u(this.value(),function(n){n.width&&n.height&&a&&(s=n.width,h=n.height,o.find("#width").value(s),o.find("#height").value(h))})}function b(){function r(n){return n.length>0&&/^[0-9]+$/.test(n)&&(n+="px"),n}if(n.settings.image_advtab){var i=o.toJSON(),t=e.parseStyle(i.style);delete t.margin;t["margin-top"]=t["margin-bottom"]=r(i.vspace);t["margin-left"]=t["margin-right"]=r(i.hspace);t["border-width"]=r(i.border);o.find("#style").value(e.serializeStyle(e.parseStyle(e.serializeStyle(t))))}}var o,i={},e=n.dom,f=n.selection.getNode(),s,h,l,p,a=n.settings.image_dimensions!==!1,c;s=e.getAttrib(f,"width");h=e.getAttrib(f,"height");f.nodeName!="IMG"||f.getAttribute("data-mce-object")||f.getAttribute("data-mce-placeholder")?f=null:i={src:e.getAttrib(f,"src"),alt:e.getAttrib(f,"alt"),"class":e.getAttrib(f,"class"),width:s,height:h};t&&(l={type:"listbox",label:"Image list",values:r(t,function(t){t.value=n.convertURL(t.value||t.url,"src")},[{text:"None",value:""}]),value:i.src&&n.convertURL(i.src,"src"),onselect:function(n){var t=o.find("#alt");(!t.value()||n.lastControl&&t.value()==n.lastControl.text())&&t.value(n.control.text());o.find("#src").value(n.control.value()).fire("change")},onPostRender:function(){l=this}});n.settings.image_class_list&&(p={name:"class",type:"listbox",label:"Class",values:r(n.settings.image_class_list,function(t){t.value&&(t.textStyle=function(){return n.formatter.getCssText({inline:"img",classes:[t.value]})})})});c=[{name:"src",type:"filepicker",filetype:"image",label:"Source",autofocus:!0,onchange:k},l];n.settings.image_description!==!1&&c.push({name:"alt",type:"textbox",label:"Image description"});a&&c.push({type:"container",label:"Dimensions",layout:"flex",direction:"row",align:"center",spacing:5,items:[{name:"width",type:"textbox",maxLength:5,size:3,onchange:v,ariaLabel:"Width"},{type:"label",text:"x"},{name:"height",type:"textbox",maxLength:5,size:3,onchange:v,ariaLabel:"Height"},{name:"constrain",type:"checkbox",checked:!0,text:"Constrain proportions"}]});c.push(p);n.settings.image_advtab?(f&&(i.hspace=y(f.style.marginLeft||f.style.marginRight),i.vspace=y(f.style.marginTop||f.style.marginBottom),i.border=y(f.style.borderWidth),i.style=n.dom.serializeStyle(n.dom.parseStyle(n.dom.getAttrib(f,"style")))),o=n.windowManager.open({title:"Insert/edit image",data:i,bodyType:"tabpanel",body:[{title:"General",type:"form",items:c},{title:"Advanced",type:"form",pack:"start",items:[{label:"Style",name:"style",type:"textbox"},{type:"form",layout:"grid",packV:"start",columns:2,padding:0,alignH:["left","right"],defaults:{type:"textbox",maxWidth:50,onchange:b},items:[{label:"Vertical space",name:"vspace"},{label:"Horizontal space",name:"hspace"},{label:"Border",name:"border"}]}]}],onSubmit:w})):o=n.windowManager.open({title:"Insert/edit image",data:i,body:c,onSubmit:w})}n.addButton("image",{icon:"image",tooltip:"Insert/edit image",onclick:t(i),stateSelector:"img:not([data-mce-object],[data-mce-placeholder])"});n.addMenuItem("image",{icon:"image",text:"Insert image",onclick:t(i),context:"insert",prependToContext:!0});n.addCommand("mceImage",t(i))});
/*
//# sourceMappingURL=plugin.min.js.map
*/
tinymce.PluginManager.add("link",function(n){function i(t){return function(){var i=n.settings.link_list;typeof i=="string"?tinymce.util.XHR.send({url:i,success:function(n){t(tinymce.util.JSON.parse(n))}}):typeof i=="function"?i(t):t(i)}}function r(n,t,i){function r(n,i){return i=i||[],tinymce.each(n,function(n){var u={text:n.text||n.title};n.menu?u.menu=r(n.menu):(u.value=n.value,t&&t(u));i.push(u)}),i}return r(n,i||[])}function t(t){function k(n){var t=c.find("#text");(!t.value()||n.lastControl&&t.value()==n.lastControl.text())&&t.value(n.control.text());c.find("#href").value(n.control.value())}function g(t){var i=[];return tinymce.each(n.dom.select("a:not([href])"),function(n){var r=n.name||n.id;r&&i.push({text:r,value:"#"+r,selected:t.indexOf("#"+r)!=-1})}),i.length?(i.unshift({text:"None",value:""}),{name:"anchor",type:"listbox",label:"Anchors",values:i,onselect:k}):void 0}function d(){!l&&i.text.length===0&&o&&this.parent().parent().find("#text")[0].value(this.value())}function nt(t){var i=t.meta||{};s&&s.value(n.convertURL(this.value(),"href"));tinymce.each(t.meta,function(n,t){c.find("#"+t).value(n)});i.text||d.call(this)}function tt(n){var r=h.getContent(),t,i;if(/</.test(r)&&(!/^<a [^>]+>[^<]+<\/a>$/.test(r)||r.indexOf("href=")==-1))return!1;if(n){if(t=n.childNodes,t.length===0)return!1;for(i=t.length-1;i>=0;i--)if(t[i].nodeType!=3)return!1}return!0}var i={},h=n.selection,f=n.dom,a,u,l,c,o,v,s,y,p,w,b,e;a=h.getNode();u=f.getParent(a,"a[href]");o=tt();i.text=l=u?u.innerText||u.textContent:h.getContent({format:"text"});i.href=u?f.getAttrib(u,"href"):"";(e=f.getAttrib(u,"target"))?i.target=e:n.settings.default_link_target&&(i.target=n.settings.default_link_target);(e=f.getAttrib(u,"rel"))&&(i.rel=e);(e=f.getAttrib(u,"class"))&&(i["class"]=e);(e=f.getAttrib(u,"title"))&&(i.title=e);o&&(v={name:"text",type:"textbox",size:40,label:"Text to display",onchange:function(){i.text=this.value()}});t&&(s={type:"listbox",label:"Link list",values:r(t,function(t){t.value=n.convertURL(t.value||t.url,"href")},[{text:"None",value:""}]),onselect:k,value:n.convertURL(i.href,"href"),onPostRender:function(){s=this}});n.settings.target_list!==!1&&(n.settings.target_list||(n.settings.target_list=[{text:"None",value:""},{text:"New window",value:"_blank"}]),p={name:"target",type:"listbox",label:"Target",values:r(n.settings.target_list)});n.settings.rel_list&&(y={name:"rel",type:"listbox",label:"Rel",values:r(n.settings.rel_list)});n.settings.link_class_list&&(w={name:"class",type:"listbox",label:"Class",values:r(n.settings.link_class_list,function(t){t.value&&(t.textStyle=function(){return n.formatter.getCssText({inline:"a",classes:[t.value]})})})});n.settings.link_title!==!1&&(b={name:"title",type:"textbox",label:"Title",value:i.title});c=n.windowManager.open({title:"Insert link",data:i,body:[{name:"href",type:"filepicker",filetype:"file",size:40,autofocus:!0,label:"Url",onchange:nt,onkeyup:d},v,b,g(i.href),s,y,p,w],onSubmit:function(t){function s(t,i){var r=n.selection.getRng();window.setTimeout(function(){n.windowManager.confirm(t,function(t){n.selection.setRng(r);i(t)})},0)}function e(){var t={href:r,target:i.target?i.target:null,rel:i.rel?i.rel:null,"class":i["class"]?i["class"]:null,title:i.title?i.title:null};u?(n.focus(),o&&i.text!=l&&("innerText"in u?u.innerText=i.text:u.textContent=i.text),f.setAttribs(u,t),h.select(u),n.undoManager.add()):o?n.insertContent(f.createHTML("a",t,f.encode(i.text))):n.execCommand("mceInsertLink",!1,t)}var r;if(i=tinymce.extend(i,t.data),r=i.href,!r){n.execCommand("unlink");return}if(r.indexOf("@")>0&&r.indexOf("//")==-1&&r.indexOf("mailto:")==-1){s("The URL you entered seems to be an email address. Do you want to add the required mailto: prefix?",function(n){n&&(r="mailto:"+r);e()});return}if(/^\s*www\./i.test(r)){s("The URL you entered seems to be an external link. Do you want to add the required http:// prefix?",function(n){n&&(r="http://"+r);e()});return}e()}})}n.addButton("link",{icon:"link",tooltip:"Insert/edit link",shortcut:"Ctrl+K",onclick:i(t),stateSelector:"a[href]"});n.addButton("unlink",{icon:"unlink",tooltip:"Remove link",cmd:"unlink",stateSelector:"a[href]"});n.addShortcut("Ctrl+K","",i(t));n.addCommand("mceLink",i(t));this.showDialog=t;n.addMenuItem("link",{icon:"link",text:"Insert link",shortcut:"Ctrl+K",onclick:i(t),stateSelector:"a[href]",context:"insert",prependToContext:!0})});
/*
//# sourceMappingURL=plugin.min.js.map
*/